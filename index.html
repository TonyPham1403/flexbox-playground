<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flex Playground th√¥ng minh</title>
    <style>
        body {
            font-family: sans-serif;
            background: #fafafa;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .controls {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        label {
            font-size: 14px;
        }

        select,
        input[type="number"] {
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid #aaa;
            width: 90px;
        }

        select:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .container {
            display: flex;
            background: #eee;
            border: 2px dashed #bbb;
            padding: 10px;
            width: 600px;
            height: 400px;
            resize: both;
            overflow: auto;
        }

        .item {
            /* width: 80px;
            height: auto; */
            width: 80px;
            /* height: 80px; */
            background: #4a90e2;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            /* margin: 4px; */
            border-radius: 6px;
            flex-grow: 0;
            flex-shrink: 1;
            position: relative;

            /* TH√äM D√íNG N√ÄY V√ÄO CSS */
            min-height: 80px;
        }

        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            right: 6px;
            bottom: 6px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 2px;
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.08) inset;
            cursor: se-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333;
            user-select: none;
        }
    </style>
</head>

<body>

    <h2>üß© Flexbox Playground (t·ª± disable thu·ªôc t√≠nh v√¥ hi·ªáu)</h2>

    <div class="controls">
        <label>
            Justify-content:
            <select id="justify">
                <option>flex-start</option>
                <option>center</option>
                <option>flex-end</option>
                <option>space-between</option>
                <option>space-around</option>
                <option>space-evenly</option>
            </select>
        </label>

        <label>
            Align-items:
            <select id="align">
                <option>flex-start</option>
                <option>center</option>
                <option>flex-end</option>
                <option>stretch</option>
            </select>
        </label>

        <label>
            Align-content:
            <select id="alignContent">
                <option>flex-start</option>
                <option>center</option>
                <option>flex-end</option>
                <option>space-between</option>
                <option>space-around</option>
                <option>space-evenly</option>
                <option>stretch</option>
            </select>
        </label>

        <label>
            Flex-grow:
            <select id="grow">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
            </select>
        </label>

        <label>
            Flex-shrink:
            <select id="shrink">
                <option value="0">0</option>
                <option value="1" selected>1</option>
                <option value="2">2</option>
            </select>
        </label>

        <label>
            Direction:
            <select id="direction">
                <option value="row">row</option>
                <option value="column">column</option>
            </select>
        </label>

        <label>
            Wrap:
            <select id="wrap">
                <option value="nowrap" selected>nowrap</option>
                <option value="wrap">wrap</option>
                <option value="wrap-reverse">wrap-reverse</option>
            </select>
        </label>
        <label>
            Gap (px):
            <input id="gap" type="number" min="0" max="100" value="4">
        </label>

        <label>
            S·ªë l∆∞·ª£ng √¥:
            <input id="count" type="number" min="1" max="100" value="6">
        </label>
        <label>
            <button id="resetSizes" type="button">Reset k√≠ch th∆∞·ªõc</button>
        </label>
        <label>
            <button id="undoReset" type="button" disabled>Undo reset</button>
        </label>
    </div>

    <div class="container" id="frame"></div>

    <script>
        const container = document.getElementById("frame");
        const justify = document.getElementById("justify");
        const align = document.getElementById("align");
        const alignContent = document.getElementById("alignContent");
        const grow = document.getElementById("grow");
        const shrink = document.getElementById("shrink");
        const direction = document.getElementById("direction");
        const wrap = document.getElementById("wrap");
        const count = document.getElementById("count");
        const gap = document.getElementById("gap");

        function createItems(num) {
            container.innerHTML = "";
            for (let i = 1; i <= num; i++) {
                const div = document.createElement("div");
                div.className = "item";
                div.textContent = i;
                // add resize handle
                const handle = document.createElement('span');
                handle.className = 'resize-handle';
                handle.title = 'K√©o ƒë·ªÉ thay ƒë·ªïi k√≠ch th∆∞·ªõc\nDouble-click ƒë·ªÉ reset';
                handle.textContent = '';
                div.appendChild(handle);
                initResizeHandle(div, handle);
                container.appendChild(div);
            }
        }

        function updateFlex() {
            container.style.justifyContent = justify.value;
            container.style.alignItems = align.value;
            container.style.alignContent = alignContent.value;
            container.style.flexDirection = direction.value;
            container.style.flexWrap = wrap.value;
            container.style.gap = gap.value + "px";

            document.querySelectorAll(".item").forEach(el => {
                el.style.flexGrow = grow.value;
                el.style.flexShrink = shrink.value;
            });
            updateItemSizeByDirection();
            // üö¶ Logic disable th√¥ng minh
            updateDisabledStates();
        }

        function updateItemSizeByDirection() {
            const dir = direction.value;
            const items = document.querySelectorAll(".item");
            const isStretch = (align.value === "stretch");
            const isWrap = wrap.value !== "nowrap";

            items.forEach(item => {
                const isManual = item.dataset.manualSize === 'true';

                if (!isStretch) {
                    // Kh√¥ng stretch ‚Üí √©p item th√†nh h√¨nh vu√¥ng 80x80
                    if (!isManual) {
                        item.style.width = "80px";
                        item.style.height = "80px";
                    }
                    return;
                }

                // Stretch
                if (dir === "row") {
                    if (!isManual) item.style.width = "80px"; // tr·ª•c ch√≠nh = row, width c·ªë ƒë·ªãnh
                    if (isWrap) {
                        // wrap + stretch ‚Üí ƒë·ªÉ Flexbox t·ª± stretch theo h√†ng
                        if (!isManual) item.style.height = "";
                    } else {
                        // nowrap ‚Üí stretch theo container
                        if (!isManual) item.style.height = "100%";
                    }
                } else { // column
                    if (!isManual) item.style.height = "80px"; // tr·ª•c ch√≠nh = column, height c·ªë ƒë·ªãnh
                    if (isWrap) {
                        // wrap + stretch ‚Üí ƒë·ªÉ Flexbox t·ª± stretch theo h√†ng
                        if (!isManual) item.style.width = "";
                    } else {
                        // nowrap ‚Üí stretch theo container
                        if (!isManual) item.style.width = "100%";
                    }
                }
            });
        }

        // Initialize a resize handle for an item
        function initResizeHandle(item, handle) {
            let startX = 0, startY = 0, startW = 0, startH = 0;
            let pointerId = null;

            handle.addEventListener('pointerdown', (e) => {
                e.stopPropagation();
                pointerId = e.pointerId;
                handle.setPointerCapture(pointerId);
                startX = e.clientX;
                startY = e.clientY;
                const rect = item.getBoundingClientRect();
                startW = rect.width;
                startH = rect.height;
                // prevent text selection
                document.body.style.userSelect = 'none';

                function onPointerMove(ev) {
                    if (ev.pointerId !== pointerId) return;
                    const dx = ev.clientX - startX;
                    const dy = ev.clientY - startY;
                    // compute new size, enforce minimum
                    const newW = Math.max(20, Math.round(startW + dx));
                    const newH = Math.max(20, Math.round(startH + dy));
                    item.style.width = newW + 'px';
                    item.style.height = newH + 'px';
                    item.dataset.manualSize = 'true';
                }

                function onPointerUp(ev) {
                    if (ev.pointerId === pointerId) {
                        try { handle.releasePointerCapture(pointerId); } catch (e) { }
                        pointerId = null;
                        document.removeEventListener('pointermove', onPointerMove);
                        document.removeEventListener('pointerup', onPointerUp);
                        document.body.style.userSelect = '';
                    }
                }

                document.addEventListener('pointermove', onPointerMove);
                document.addEventListener('pointerup', onPointerUp);
            });

            // double-click on handle resets manual size
            handle.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                delete item.dataset.manualSize;
                // clear inline sizes so updateFlex can reapply defaults
                item.style.width = '';
                item.style.height = '';
                updateFlex();
            });
        }




        function updateDisabledStates() {
            // N·∫øu wrap = nowrap ‚Üí align-content v√¥ d·ª•ng
            alignContent.disabled = (wrap.value === "nowrap");

            // N·∫øu flex-grow > 0 ‚Üí justify-content g·∫ßn nh∆∞ v√¥ nghƒ©a (chi·∫øm h·∫øt chi·ªÅu r·ªông)
            justify.disabled = (parseInt(grow.value) > 0);

            // N·∫øu item c√≥ height c·ªë ƒë·ªãnh ‚Üí align-items: stretch kh√¥ng c√≥ t√°c d·ª•ng,
            // nh∆∞ng v·∫´n ƒë·ªÉ ng∆∞·ªùi d√πng ch·ªçn (v√¨ ch·ªâ 1 ph·∫ßn v√¥ d·ª•ng)
            // => Kh√¥ng disable align-items.

            // N·∫øu wrap kh√°c nowrap m√† direction = column ‚Üí align-content l√∫c n√†y canh theo chi·ªÅu ngang
            // v·∫´n h·ª£p l·ªá, n√™n kh√¥ng c·∫ßn disable.

            // N·∫øu flex-direction = column ‚Üí tr·ª•c ch√≠nh d·ªçc, nh∆∞ng justify v·∫´n ho·∫°t ƒë·ªông n√™n gi·ªØ nguy√™n.

            // N·∫øu wrap = nowrap ‚Üí align-content stretch b·ªã v√¥ nghƒ©a
            // (ƒë√£ x·ª≠ l√Ω ·ªü tr√™n)

            // shrink lu√¥n ho·∫°t ƒë·ªông, n√™n kh√¥ng disable.
        }

        createItems(count.value);
        updateFlex();


        [justify, align, alignContent, grow, shrink, direction, wrap, gap].forEach(sel => {
            sel.addEventListener("change", updateFlex);
        });

        count.addEventListener("input", () => {
            createItems(count.value);
            updateFlex();
        });

        // Reset manual sizes for all items (with snapshot for undo)
        const resetBtn = document.getElementById('resetSizes');
        const undoBtn = document.getElementById('undoReset');
        let lastResetSnapshot = null;

        resetBtn.addEventListener('click', () => {
            // take snapshot of current per-item manual flags and inline sizes
            const items = Array.from(document.querySelectorAll('.item'));
            lastResetSnapshot = items.map(item => ({
                text: item.textContent,
                manual: item.dataset.manualSize || null,
                width: item.style.width || null,
                height: item.style.height || null
            }));

            // perform reset
            items.forEach(item => {
                delete item.dataset.manualSize;
                item.style.width = '';
                item.style.height = '';
            });
            updateFlex();
            // enable undo
            undoBtn.disabled = false;
        });

        // Undo the last reset (restore snapshot)
        undoBtn.addEventListener('click', () => {
            if (!lastResetSnapshot) return;
            const items = Array.from(document.querySelectorAll('.item'));
            // restore to matching items by index (ignores extra/missing items)
            lastResetSnapshot.forEach((snap, idx) => {
                const item = items[idx];
                if (!item) return;
                if (snap.manual === null) delete item.dataset.manualSize;
                else item.dataset.manualSize = snap.manual;
                if (snap.width === null) item.style.width = '';
                else item.style.width = snap.width;
                if (snap.height === null) item.style.height = '';
                else item.style.height = snap.height;
            });
            // clear snapshot and disable undo
            lastResetSnapshot = null;
            undoBtn.disabled = true;
            updateFlex();
        });
    </script>

</body>

</html>
